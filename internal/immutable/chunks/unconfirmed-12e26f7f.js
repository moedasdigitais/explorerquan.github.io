import{w as f}from"./index-08e0cf00.js";let n;const l={list:[]},{subscribe:u,update:p}=f(l),b=(e,t)=>{if(e===0)return"0 Bytes";const r=1024,i=t||2,s=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,a)).toFixed(i))+" "+s[a]},m=e=>{p(t=>(t.list=e,t))},d=async e=>{const t=Object.assign({});for(let r=e.length-1;r>=0;r--){const i=e[r];if(i){const s=i.split(":");s.length===2&&(s[0].trim()==="id"&&(t[s[0].trim()]=s[1].trim()),s[0].trim()==="blobSize"&&(t[s[0].trim()]=b(Number(s[1].trim()))),s[0].trim()==="amount_out"&&(t[s[0].trim()]=(parseInt(s[1].trim())/1e8).toFixed(8)),s[0].trim()==="received_timestamp"&&(t[s[0].trim()]=Number(s[1].trim())),s[0].trim()==="fee"&&(t[s[0].trim()]=Number(s[1].trim())))}if(r===0)return t}},g=async e=>{const t=[];for(let r=e.length-1;r>=0;r--){if(e[r]){const s=await d(e[r].split(`
`));s&&t.push(s)}if(r===0)return t}},h=async(e,t)=>{if(e&&t){const r=await fetch(e,t).then(i=>i.text());if(r){const i=r.split('"result":{"status":"OK","transactions":"')[0],s=r.replace(i+'"result":{"status":"OK","transactions":"',"").replace(`

"}}`,"").replace('"}}',"");if(s.trim().length>0){const a=s.split(`

`),c=await g(a);if(c)return{res:c}}else m([])}}else return{error:"needs: url and config object"}},w=async e=>{const t=await h(e+"/json_rpc",{method:"POST",body:JSON.stringify({jsonrpc:"2.0",id:"test",method:"f_pool_json",params:{}})});if(t&&(t.error||t.res))return t},o=Object.assign({});o.startList=async e=>{const{url:t,callback:r}=e,i=await w(t);if(i){if(i.error)return!0;if(i.res)return m(i.res),r(t,5e3),!0}};o.loop=(e,t)=>{const r=new Date().getTime();n?l.lastUnixTime+t>=r-300?n=setTimeout(()=>o.sstartList({url:e,callback:o.loop}),t):(clearTimeout(n),n=setTimeout(()=>o.startList({url:e,callback:o.loop}),t*2)):n=setTimeout(()=>o.startList({url:e,callback:o.loop}),t)};const B=async e=>e?(await o.startList({url:e,callback:o.loop}),!0):!1,T=()=>clearTimeout(n),j={subscribe:u,init:B,stop:T};export{j as u};
